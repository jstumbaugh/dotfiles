# Remove non-alpha characters: darwin10.0 -> darwin
OS=$(echo $OSTYPE | sed "s/[^a-zA-Z-]//g")

# some more ls aliases
alias ll='ls -lF'
alias l='ls -lF'
alias lt='ls -ltF'
alias la='ls -A'

alias so='source ~/.bash/aliases; echo "Reloaded ~/.bash/aliases"'

# cd
alias ..='cd ..'

# JASON'S COMMANDS
# git commands
alias g='git'
alias gs='git status -s'
alias gd='git diff'
alias ga='git add'
alias gco='git checkout'
alias gc='git commit -v'
alias gp='git push'
alias gpo='git push origin'
alias gdm="git branch --merged | egrep -v '\*|next|master' | xargs -L 1 -n 1 git branch --delete"
alias gf='git fetch'
alias gpl='git pull'
alias gl='git l'
alias gap='git add --patch'
alias gr='git rebase'
alias grc='git rebase --continue'

# bundler commands
alias b='bundle'
alias be='bundle exec'
alias bers='bundle exec rails server'

alias screen='screen -T $TERM'

alias e="$EDITOR"
alias v="$VISUAL"

alias less="less -FrX"
alias hi="history | tail -35"

# rake
alias r="bundle exec rake"
alias rake="bundle exec rake"
alias tests="bundle exec rake db:migrate; bundle exec rake db:test:prepare; bundle exec rake"

# rails
alias tlog='tail -f log/development.log'
alias rc='rails console'

# rails migration
alias rdm='bundle exec rake db:migrate'
alias rdr='bundle exec rake db:rollback'
alias rdtp="bundle exec rake db:test:prepare"

function bl {
  if [[ $# -gt 0 ]]; then
    "$@"

    status=$?

    light_red="C00000"
    light_green="00C000"
    status_color=$light_green

    if [[ $status -gt 0 ]]; then
      status_color=$light_red
    fi

    blink1 --rgb=$status_color --glimmer=5 -q &

    return $status
  else
    blink1 --random=3 -t 300 -q && blink1 --off -q &
  fi
}

function g {
  if [[ $# -gt 0 ]]; then
    git "$@"
  else
    git status -s
  fi
}

function tlf {
  if [[ $# == 0 && -f log/development.log ]]; then
    less -FRSX +F log/development.log
  else
    less -FRSX +F "$@"
  fi
}

function browse {
  if [[ $# -gt 0 ]]; then
    xdg-open "$@" > /dev/null 2>&1 &
  else

    if [[ -f .env ]]; then
      port=$(grep PORT .env | cut --delimiter== --fields=2)

      if [[ $port == "" ]]; then
        port=3000
      fi
    fi

    echo "Opening \"http://localhost:${port}\" in your browserâ€¦"

    xdg-open "http://localhost:${port}" > /dev/null 2>&1 &
  fi
}

# enable color support of ls and also add handy aliases
if [ "$TERM" != "dumb" ]; then
  if [[ $OS == "darwin" ]]; then
    alias ls='ls -Gh'
  else
    alias ls='ls --color=auto -hB'
  fi
fi

# IPython Notebook alias w/pylab support
alias ipynb='ipython notebook --pylab inline'

# Random Password Function
randpw(){ date +%s | shasum | base64 | head -c 32 ; echo; }

# Pushover push function (for notification when running long jobs
function push {
  : ${TITLE:="$2"}
  : ${TITLE:="$USER"}
  curl -s -F "token=$PUSHER_TERMINAL_TOKEN" \
  -F "user=$PUSHER_USER_KEY" \
  -F "title=$TITLE" \
  -F "message=$1" https://api.pushover.net/1/messages.json > /dev/null
}

# vim: syntax=sh
